<!-- sections/problem-solution.liquid -->

<section class="pbs-problem-solution-section">
  <div class="pbs-container">
    <div class="pbs-problem-solution-grid pbs-layout-{{ section.settings.layout }}">
      <div class="pbs-problem-image">
        {% if section.settings.media_type == 'video' and section.settings.video != blank %}
          <video class="pbs-video" autoplay muted loop playsinline>
            <source src="{{ section.settings.video }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        {% elsif section.settings.image != blank %}
          <img src="{{ section.settings.image | img_url: 'master' }}" alt="{{ section.settings.heading }}">
        {% else %}
          <div class="pbs-placeholder-image">
            {{ 'image' | placeholder_svg_tag }}
          </div>
        {% endif %}
      </div>
      
      <div class="pbs-problem-content">
        <h2 class="pbs-problem-heading">{{ section.settings.heading }}</h2>
        
        {% for block in section.blocks %}
          <div class="pbs-problem-text" {{ block.shopify_attributes }}>
            <p>{{ block.settings.paragraph }}</p>
          </div>
        {% endfor %}
        
        {% if section.settings.show_cta and section.settings.product != blank %}
          {%- assign selected_product = section.settings.product -%}
          {%- assign current_variant = selected_product.selected_or_first_available_variant -%}
          
          <div class="pbs-product-action">
            {%- if current_variant.available -%}
              {%- capture Button -%}
                <button type="button" class="pbs-problem-cta">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="white" class="pbs-cart-icon">
                    <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
                  </svg>
                  <span class="pbs-cta-text">{{ section.settings.cta_text }}</span>
                </button>
              {%- endcapture -%}

              {% render 'product-to-cart', 
                  trigger: Button, 
                  variant: current_variant
              %}
            {%- else -%}
              <button type="button" class="pbs-problem-cta" disabled>
                <span class="pbs-cta-text">{{ 'products.product.sold_out' | t }}</span>
              </button>
            {%- endif -%}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<style>
  .pbs-problem-solution-section {
    background: {{ section.settings.background_color }};
    padding: 80px 20px;
  }

  .pbs-problem-solution-section .pbs-container {
    max-width: 1300px;
    margin: 0 auto;
  }

  .pbs-problem-solution-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: center;
  }

  .pbs-problem-solution-grid.pbs-layout-image-right .pbs-problem-image {
    order: 2;
  }

  .pbs-problem-solution-grid.pbs-layout-image-right .pbs-problem-content {
    order: 1;
  }

  .pbs-problem-image img {
    width: 100%;
    height: auto;
    border-radius: 12px;
  }

  .pbs-video {
    width: 100%;
    height: auto;
    border-radius: 12px;
    display: block;
  }

  .pbs-placeholder-image {
    width: 100%;
    aspect-ratio: 4/3;
    background: #f0f0f0;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .pbs-problem-heading {
    font-size: 32px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 25px;
    line-height: 1.3;
  }

  .pbs-problem-text {
    margin-bottom: 20px;
  }

  .pbs-problem-text p {
    font-size: 16px;
    line-height: 1.7;
    color: #333;
    margin: 0;
  }

  .pbs-product-action {
    margin-top: 20px;
  }

  .pbs-problem-cta {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: linear-gradient(115deg, #c740a3, #9140c7);
    color: white;
    padding: 16px 32px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    width: 100%;
    justify-content: center;
    border: none;
    cursor: pointer;
    font-family: inherit;
  }

  .pbs-problem-cta:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: #ccc;
  }

  .pbs-problem-cta:hover:not(:disabled) {
    background: linear-gradient(115deg, #c740a3, #9140c7);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  @media (max-width: 968px) {
    .pbs-problem-solution-grid {
      grid-template-columns: 1fr;
      gap: 40px;
    }

    .pbs-problem-heading {
      font-size: 26px;
    }

    .pbs-problem-image {
      order: -1;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const ctaButtons = document.querySelectorAll('.pbs-problem-cta');
    ctaButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "Problem Solution",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "image-left",
          "label": "Image Left"
        },
        {
          "value": "image-right",
          "label": "Image Right"
        }
      ],
      "default": "image-left"
    },
    {
      "type": "select",
      "id": "media_type",
      "label": "Media Type",
      "options": [
        {
          "value": "image",
          "label": "Image"
        },
        {
          "value": "video",
          "label": "Video"
        }
      ],
      "default": "image"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image",
      "info": "Used when Media Type is set to Image"
    },
    {
      "type": "url",
      "id": "video",
      "label": "Video URL",
      "info": "Enter the full video URL (e.g., https://cdn.shopify.com/videos/c/o/v/video.mp4). Used when Media Type is set to Video"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "SOLVED: The Real Reason Behind Your Knee Pain:"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "checkbox",
      "id": "show_cta",
      "label": "Show CTA Button",
      "default": true
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "Add to cart"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Select Product",
      "info": "Choose the product to add to cart when button is clicked"
    }
  ],
  "blocks": [
    {
      "type": "paragraph",
      "name": "Paragraph",
      "settings": [
        {
          "type": "textarea",
          "id": "paragraph",
          "label": "Paragraph Text",
          "default": "Your paragraph text here."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Problem Solution",
      "blocks": [
        {
          "type": "paragraph",
          "settings": {
            "paragraph": "Knee pain isn't just about getting older—it's about what's missing in your knees. Your joints need something called synovial fluid. It's like oil that keeps your knees moving smoothly and without pain."
          }
        },
        {
          "type": "paragraph",
          "settings": {
            "paragraph": "This is called Joint Drought – when you don't have enough synovial fluid, your knees dry out and rub bone on bone."
          }
        },
        {
          "type": "paragraph",
          "settings": {
            "paragraph": "Without enough movement, this fluid can't flow right, and your knees start to creak like a rusty door hinge. But how do you move when you're in pain?"
          }
        }
      ]
    }
  ]
}
{% endschema %}