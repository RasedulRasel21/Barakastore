<!-- sections/how-it-works.liquid -->

<section class="how-it-works-section">
  <div class="container">
    <h2 class="how-heading">{{ section.settings.heading }}</h2>
    <p class="how-subheading">{{ section.settings.subheading }}</p>
    <p class="how-description">{{ section.settings.description }}</p>
    
    <div class="steps-grid">
      {% for block in section.blocks %}
        <div class="step-item" {{ block.shopify_attributes }}>
          <div class="step-image">
            {% if block.settings.media_type == 'video' and block.settings.video != blank %}
              <video autoplay loop muted playsinline>
                <source src="{{ block.settings.video }}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            {% elsif block.settings.image != blank %}
              <img src="{{ block.settings.image | img_url: 'master' }}" alt="{{ block.settings.title }}">
            {% else %}
              <div class="placeholder-image">
                {{ 'image' | placeholder_svg_tag }}
              </div>
            {% endif %}
          </div>
          <div class="step-content">
            <h3 class="step-title">{{ block.settings.title }}</h3>
            <p class="step-description">{{ block.settings.description }}</p>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if section.settings.show_cta and section.settings.product != blank %}
      {%- assign selected_product = section.settings.product -%}
      {%- assign current_variant = selected_product.selected_or_first_available_variant -%}
      
      <div class="how-cta-wrapper">
        {%- if current_variant.available -%}
          {%- capture Button -%}
            <button type="button" class="how-cta">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
              </svg>
              {{ section.settings.cta_text }}
            </button>
          {%- endcapture -%}

          {% render 'product-to-cart', 
              trigger: Button, 
              variant: current_variant
          %}
        {%- else -%}
          <button type="button" class="how-cta" disabled>
            {{ 'products.product.sold_out' | t }}
          </button>
        {%- endif -%}
      </div>
    {% endif %}
  </div>
</section>

<style>
  .how-it-works-section {
    background: {{ section.settings.background_color }};
    padding: 80px 20px;
  }

  .how-it-works-section .container {
    max-width: 1300px;
    margin: 0 auto;
  }

  .how-heading {
    font-size: 32px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 15px;
    text-align: center;
  }

  .how-subheading {
    font-size: 16px;
    color: #666;
    text-align: center;
    margin-bottom: 10px;
  }

  .how-description {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
    text-align: center;
    margin-bottom: 50px;
  }

  .steps-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
  }

  .step-item {
    text-align: left;
  }

  .step-image {
    margin-bottom: 20px;
    border-radius: 12px;
    overflow: hidden;
  }

  .step-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .step-image video {
    width: 100%;
    height: auto;
    display: block;
  }

  .placeholder-image {
    width: 100%;
    aspect-ratio: 4/3;
    background: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .step-title {
    font-size: 18px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 10px;
  }

  .step-description {
    font-size: 14px;
    line-height: 1.6;
    color: #555;
  }

  .how-cta-wrapper {
    text-align: center;
    margin-top: 40px;
  }

  .how-cta {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: linear-gradient(115deg, #c740a3, #9140c7);
    color: white;
    padding: 16px 32px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    width: 30%;
    justify-content: center;
    border: none;
    cursor: pointer;
    font-family: inherit;
    text-decoration: none;
  }

  .how-cta:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: #ccc;
  }

  .how-cta:hover:not(:disabled) {
    background: linear-gradient(115deg, #c740a3, #9140c7);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  @media (max-width: 768px) {
    .how-heading {
      font-size: 26px;
    }

    .steps-grid {
      grid-template-columns: 1fr;
    }

    .how-cta {
      width: 80%;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const ctaButtons = document.querySelectorAll('.how-cta');
    ctaButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "How The Knee Relief Mas",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "How The Knee Relief Massager Works:"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "The Knee Relief Massager is expertly built to soothe knee pain and make your knee joints stronger."
    },
    {
      "type": "text",
      "id": "description",
      "label": "Description",
      "default": "Simply please it over your knee, adjust for your comfort, and feel the relief."
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "checkbox",
      "id": "show_cta",
      "label": "Show CTA Button",
      "default": true
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "Add to cart"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Select Product",
      "info": "Choose the product to add to cart when button is clicked"
    }
  ],
  "blocks": [
    {
      "type": "step",
      "name": "Step",
      "settings": [
        {
          "type": "select",
          "id": "media_type",
          "label": "Media Type",
          "options": [
            {
              "value": "image",
              "label": "Image"
            },
            {
              "value": "video",
              "label": "Video"
            }
          ],
          "default": "image"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Step Image"
        },
        {
          "type": "text",
          "id": "video",
          "label": "Video URL",
          "info": "Enter the full URL to your video file (MP4 format recommended)"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Step Title",
          "default": "Step 1"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Step Description",
          "default": "Description of this step."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "How It Works",
      "blocks": [
        {
          "type": "step",
          "settings": {
            "title": "Step 1",
            "description": "Place the massager around your knee and secure it."
          }
        },
        {
          "type": "step",
          "settings": {
            "title": "Step 2",
            "description": "Adjust the settings for a comfortable yet effective treatment to stabilize your knee."
          }
        },
        {
          "type": "step",
          "settings": {
            "title": "Step 3",
            "description": "Go about your day, enjoying pain-free movement."
          }
        },
        {
          "type": "step",
          "settings": {
            "title": "Step 4",
            "description": "Use it during any activity, from walking to resting, ensuring continuous knee support."
          }
        }
      ]
    }
  ]
}
{% endschema %}